\chapter{Regiões Densas Interessantes (IDRs)}

Nesta seção nós iremos explanar mais profundamente o conceito de Regiões Densamente Interessantes e qual a sua utilidade em uma análise de dados espaciais. Também detalharemos o passo a passo para a criação de uma Região desse tipo, qual a função do feedback do usuário nessa construção, qual o algoritmo usado para esse processo, qual sua utilização no GeoGuide e quais as vantagens que podemos obter quando utilizamos Regiões Densamente Interessantes para fazer análise de dados espaciais com uma abordagem de orientação do usuário através da ferramenta.

\section{Feedback do usuário}

Para poder explicar melhor o conceito de IDR, precisamos começar falando sobre o \textit{feedback} do usuário, como funciona e como isso pode ser utilizado na criação das Regiões. Durante a utilização de um sistema, o usuário vai interagindo com suas funcionalidades e o sistema vai respondendo aos seus comandos e ações, isso faz com que um sistema seja interativo e dinâmico, podendo ser atualizado conforme o usuário e as características de cada um. Em sistemas de análise de dados espaciais, é muito comum que seja utilizado um mapa, um gráfico ou qualquer recuso visual que facilite a interpretação do usuário e dê uma noção sobre o que se trata o dataset em si.

A partir disso, o usuário pode ir ``caminhando'' pelo mapa (ou figura) para ir conhecendo mais afundo os dados e as particularidades de cada ponto. Esse ``caminhar'' pode se tornar interessante para o sistema de forma que isso ajude a conhecer os interesses do usuário. Essa resposta que o usuário concede ao sistema enquanto o estar utlizando, é o que caracteriza o \textit{feedback} e isso pode trazer muitas utilizações para diversos tipos de sistemas.

O feedback pode ser dividido em duas categorias sobre a abordagem utilizada para sua coleta: o \textit{explícito} e o \textit{implícito}. O primeiro se refere a quando o usuário define como interessante de forma consciente utilizando meios que o próprio sistema indica como funciona e para que serve. Por exemplo: quando o usuário indica se gostou de determinada indicação, quando ele vota de 0 a 5 estrelas num filme de sua preferência, quando ele indica algum restaurante para alguém utilizando o sistema, quando ele clica num ponto no mapa para obter mais informações e de várias outras formas pode se obter um feedback explícito.

Já no caso da segunda categoria de feedback, o usuário não precisa dizer diretamente qual o seu interesse no sistema, do contrário, o sistema vai detectando progressivamente o que o usuário vai fazendo na plataforma e vai registrando isso para, a partir de uma determinada quantidade de informação, conseguir caracterizar algo como interessante para o usuário. Por exemplo, o sistema pode rastrear o movimento do mouse ou dos olhos para conseguir definir onde o usuário mais foca no sistema durante sua utilização, para isso ele precisa registrar os pontos rastreados do usuário e ir salvando isso. Então, com uma grande coleção de pontos, o sistema pode utilizar algoritmos de clusterização para encontrar as áreas mais marcantes desse conjunto e classificar elas como de interesse do usuário.

Esse tipo de feedback implícito é utilizado no GeoGuide para a captura de interesse do usuário através do rastreamento do mouse e utilizando algoritmos de clusterização para construir essas áreas que consideramos de interesse do usuário durante sua exploração pelo mapa da plataforma. Tudo isso de forma que o usuário não saiba e não precisa gastar nenhum esforço para indicar o que lhe é interessante, somente usando a plataforma já podemos detectar essa informação.

\section{Regiões no GeoGuide}

Como dito anteriormente, o feedback que o usuário entrega ao sistema é de extremo valor para o aprimoramento da ferramenta e das análises que ela performar. Isso faz com que a ferramenta tenha a característica de se adequar a cada usuário e trazer o melhor resultado para cada um em específico. Também foi abordado que no GeoGuide utilizamos o feedback implícito do rastreamento do mouse para detectar as áreas de interesse do usuário.

Entretanto, adicionamos o conceito de IDR para ir mais além nessa detecção e aprimorar a análise do usuário reforçando alguns aspectos que somente com áreas isoladas não iríamos conseguir. Esse conceito de Regiões Densamente Interessantes é baseado na detecção de áreas de interesse do usuário construídas a partir do rastreamento do seu mouse.

No GeoGuide, registramos o movimento do mouse do analista durante um determinado intervalo de tempo e os separamos em diferentes conjuntos (na Figura \ref{fig:idrs}.A podemos ver o registro de 3 momentos diferentes do movimento do mouse). Para cada conjunto, nós realizamos a clusterização desses pontos para a formação das áreas de interesse. Cada área é representada por um conjunto de pontos agrupados por sua proximidade em relação de um aos outros.

A partir desse conjunto, construímos um polígono convexo utilizando os pontos mais distantes do centro (podemos ver um exemplo disso na Figura \ref{fig:idrs}.B). Cada polígono é a representação da área de interesse do usuário. Isto posto, para a formação de uma IDR, nós dividimos uma quantidade de momentos de formação dos polígonos (as Figuras \ref{fig:idrs}.B, \ref{fig:idrs} C e \ref{fig:idrs}.D representam as formações de áreas de interesse em 3 momentos diferentes consecutivos) e definimos como IDR a interseção desses polígonos entre si (podemos ver um exemplo na Figura \ref{fig:idrs}.E marcado pela área de fundo preto quadriculado). Ou seja, na nossa ferramenta, decidimos que a cada 20 segundos de rastreamento do mouse, o sistema vai construir uma pequena série de polígonos formados a partir do cluster desses pontos de rastreio e registrar para o próximo passo. Após 3 momentos de construção de clusters, nós selecionamos todos os polígonos resultantes e calculamos novos polígonos formados pela interseção das áreas de cada momento (na Figura \ref{fig:idrs}.F podemos ver a formação de 4 IDRs a partir das interseções das áreas da Figura \ref{fig:idrs}.E). Este processo se repete enquanto o analista estiver utilizando a ferramenta.

\begin{figure*}[t]
	\centering
	\includegraphics[width=\textwidth]{images/idrs}
	\caption{Figura do processo de construção de IDRs}
	\label{fig:idrs-geoguide}
	\vspace{-10pt}
\end{figure*}

O resultado dessas interseções são o que chamamos de Regiões Densamente Interessantes, e isso torna a formação da área de interesse do usuário mais reforçada e precisa, pois cada IDR vai demonstrar uma região que o usuário focou em mais de um momento em tempos diferentes.

\begin{figure*}[t]
	\centering
	\includegraphics[width=\textwidth]{images/idrs-matching.pdf}
	\caption{Figura das sugestões do GeoGuide relacionadas com as IDRs do analista}
	\label{fig:idrs}
	\vspace{-10pt}
\end{figure*}

Por exemplo, um analista está explorando o dataset do Airbnb e deseja encontrar novas sugestões de residências. Durante sua exploração foram geradas 4 IDRs e então ele requisitou ao GeoGuide o \textit{highlight} de novos pontos e para o resultado foi levado em consideração as IDRs resultantes de sua exploração. Os pontos sugeridos pelo GeoGuide estavam em 3 das 4 regiões do analista e isso reforça o interesse dele naquelas regiões.

Com isso, cada IDR pode ser utilizada tanto para um foco mais preciso na região,caso queira restringir mais o escopo da análise, quanto para diminuir as sugestões nessa região e assim abrir mais o leque de opções do analista e expandir sua área de pesquisa, incrementando novas possibilidades para sua análise.

\section{Algoritmo}

Nós consideramos duas camadas diferentes no mapa geográfico: a ``camada espacial'' e a ``camada de interação''. A camada espacial contém os pontos espaciais $\mathcal{P}$ do dataset em análise. A camada de interação  contém os pontos $\mathcal{M}$ referente aos pontos de movimento do mouse. Nossa abordagem proposta foca um conjunto dos pontos $\mathcal{M}$ na camada de interação para descobrir uma ou mais IDRs, na qual a maioria das interações do analista ocorre. Então alinhamos os pontos espaciais $\mathcal{P}$ com as IDRs visando encontrar os pontos que estão dentro de cada região. 

\begin{algorithm}[t]
    \DontPrintSemicolon
    \KwIn{Tempo atual $t_c$, pontos dos movimentos do mouse $\mathcal{M}$}
    \KwOut{IDRs encontradas $\mathcal{S}$}
    $\mathcal{S} \gets \emptyset$\;
    $g \gets ${\em número de intervalos}\;
    \For{$i \in [0,g]$}
    {
           $\mathcal{M}_i \gets \{m = \langle x,y,t \rangle | (\frac{t_c}{g} \times i) \leq t \leq (\frac{t_c}{g} \times (i+1))\}$\;
           $\mathcal{C}_i \gets \mathit{minerar\_clusters}(\mathcal{M}_i)$\label{ln:mine}\;
           $\mathcal{O}_i \gets \mathit{encontrar\_poligonos}(\mathcal{C}_i)$\label{ln:poly}\;
    }
	\Return{$\mathcal{S}$}\; 
\caption{Algoritmo para criação de IDRs}
\label{algo:dense}
\end{algorithm}

O algoritmo \ref{algo:dense} resume nossa abordagem para encontrar as IDRs. Nós adicionamos pontos para o conjunto $\mathcal{M}$ somente a cada $200ms$ para evitar a adição de pontos repetidos. Seguindo a ideia de que o analista tem mais interesse naquela região se ele movimentar o mouse nela mais vezes e afim de minerar o comportamento recorrente do analista, o algoritmo começa pelo particionamento do conjunto $\mathcal{M}$ em $g$ segmentos consecutivos de tamanho fixo do $\mathcal{M}_0$ até o $\mathcal{M}_g$. O primeiro segmento inicia no tempo zero (quando o usuário abre o mapa) e o último segmento termina em $t_c$, ou seja, o momento atual. Baseado na ideia de que o analista pode percorrer o mapa completamente, mas isso não indicará seu real interesse por todo o mapa, nós buscamos encontrar os clusters mais densos de cada segmento do conjunto $\mathcal{M}$ utilizando um algoritmo variante do DBSCAN \cite{Ester:1996:DAD:3001460.3001507}. Por fim, nós retornamos as interseções entre esses clusters como os IDRs.

Para clusterizar os pontos em cada segmento de tempo (linha \ref{ln:mine} do Algoritmo~\ref{algo:dense}), nós usamos o ST-DBSCAN, um variante do DBSCAN para clusterizar pontos baseado na sua densidade \cite{Birant:2007}. Para cada subconjunto dos pontos do movimento do mouse $\mathcal{M}_i$, $i \in [0,g]$, o ST-DBSCAN inicia com um ponto aleatório $m_0 \in \mathcal{M}_i$ e coleciona todos os pontos ``densamente alcansáveis'' de $m_0$ usando uma métrica de distância. Como os pontos do movimento do mouse estão numa tela de 2 dimensões (isto é, o monitor), nós escolhemos a distância euclidiana como nossa métrica. Se $m_0$ for considerado um ponto central,  um cluster será gerado. Do contrário, se o $m_0$ for um ``ponto de borda'', nenhum ponto é alcançado por ele e o algoritmo escolherá outro ponto aleatório em $\mathcal{M}_i$. O processo é repetido até que todos os pontos tenham sido processados e categorizados.

Uma vez que encontramos os clusters de todos os subconjuntos de $\mathcal{M}$, nós encontramos suas interseções para encontrar regiões recorrentes (linha \ref{ln:poly}). Para obter as interseções, nós precisamos definir claramente os limites espaciais de cada cluster. Por isso, para cada cluster nós definimos um polígono correspondente que cubra todos os pontos dentro. Para conseguir isso, nós utilizamos o algoritmo Quickhull \cite{Barber:1996} , um método parecido com o \textit{quicksort} que calcula um polígono convexo para um determinado conjunto de pontos num plano 2D.

Já existem diversas formas de inferir uma região espacial para um determinado conjunto de pontos \cite{Bevis1989,DUCKHAM2008,FADILI2004,ARAMPATZIS2006,Galton2006}. A abordagem comum é agrupar os pontos em forma de polígonos concavos e convexos. Nos casos em que um polígono côncavo é construído, os ``dentes'' desse polígono podem vincular pontos que não necessariamente estariam em $\mathcal{M}$. No algoritmo de IDR, entretanto, nós adaptamos o Quickhull devido a sua simplicidade, eficiência e implementação padrão para polígonos convexos.